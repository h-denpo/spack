From e82b4a1ecb634075d8f5334b796c888c86da0427 Mon Sep 17 00:00:00 2001
From: Matthew LeGendre <legendre1@llnl.gov>
Date: Wed, 27 Nov 2019 09:57:20 -0800
Subject: [PATCH] Fix aarch64 build, use SYS_openat on systems without SYS_open

---
 src/libc_wrappers.c | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/src/libc_wrappers.c b/src/libc_wrappers.c
index 504e31a..0aac885 100644
--- a/src/libc_wrappers.c
+++ b/src/libc_wrappers.c
@@ -358,7 +358,12 @@ int gotcha_open(const char *pathname, int flags, ...)
    }
    va_end(args);
 
+#if defined(SYS_open)
    result = syscall(SYS_open, pathname, flags, mode);
+#else
+   result = syscall(SYS_openat, AT_FDCWD, pathname, flags, mode);
+#endif
+
    if (result >= 0)
       return (int) result;
    
